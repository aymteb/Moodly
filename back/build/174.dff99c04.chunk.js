"use strict";(self.webpackChunkmoodly=self.webpackChunkmoodly||[]).push([[174],{45729:function(S,M,s){s.r(M),s.d(M,{default:function(){return Y}});var t=s(74081),a=s(87006),c=s(59461),P=s(51447),f=s(12847),v=s(27279),_=s(93415),r=s(10701),m=s(32370),R=s(48102),B=s(23298),h=s(74577),l=s(12881),I=s(39708),T=s(73354),U=s(27875),W=s(74758),Z=s(76827),E=s(71563),L=s(61020),K=s(73314),x=s(68902),D=s(70627),F=s(47853),as=s(40464),ns=s(64797),es=s(85811),is=s(30594),os=s(15816),_s=s(97442),ds=s(13576),rs=s(87830),ls=s(47184),Es=s(364),Ms=s(49204),Ps=s(75719),Ds=s(74919),Os=s(29206),cs=s(98934),ms=s(43433),hs=s(8175),gs=s(10131),us=s(10124),vs=s(8243),Rs=s(63799),Ls=s(51943),As=s(39738),Cs=s(3243);const j=({disabled:d,role:n,values:i,errors:o,onChange:A,onBlur:g})=>{const{formatMessage:e}=(0,L.Z)();return(0,t.jsx)(_.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:(0,t.jsxs)(r.k,{direction:"column",alignItems:"stretch",gap:4,children:[(0,t.jsxs)(r.k,{justifyContent:"space-between",children:[(0,t.jsxs)(_.x,{children:[(0,t.jsx)(_.x,{children:(0,t.jsx)(m.Z,{fontWeight:"bold",children:n?n.name:e({id:"global.details",defaultMessage:"Details"})})}),(0,t.jsx)(_.x,{children:(0,t.jsx)(m.Z,{textColor:"neutral500",variant:"pi",children:n?n.description:e({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})})})]}),(0,t.jsx)(R.z,{disabled:!0,variant:"secondary",children:e({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:n.usersCount})})]}),(0,t.jsxs)(B.r,{gap:4,children:[(0,t.jsx)(h.P,{col:6,children:(0,t.jsx)(l.o,{disabled:d,name:"name",error:o.name&&e({id:o.name}),label:e({id:"global.name",defaultMessage:"Name"}),onChange:A,onBlur:g,required:!0,value:i.name||""})}),(0,t.jsx)(h.P,{col:6,children:(0,t.jsx)(I.g,{disabled:d,label:e({id:"global.description",defaultMessage:"Description"}),id:"description",error:o.name&&e({id:o.name}),onChange:A,onBlur:g,children:i.description||""})})]})]})})};j.defaultProps={disabled:!1,role:null,values:{name:"",description:""}},j.propTypes={disabled:D.bool,errors:D.object.isRequired,onBlur:D.func.isRequired,onChange:D.func.isRequired,role:D.object,values:D.object};const N=F.Ry().shape({name:F.Z_().required(a.I0.required)}),H=()=>{const d=(0,a.lm)(),{formatMessage:n}=(0,L.Z)(),{params:{id:i}}=(0,P.$B)("/settings/roles/:id"),{put:o}=(0,a.kY)(),[A,g]=(0,v.useState)(!1),e=(0,v.useRef)(),{lockApp:J,unlockApp:Q}=(0,a.o1)(),{trackUsage:V}=(0,a.rS)(),{formatAPIError:X}=(0,a.So)(),{isLoading:G,data:b}=(0,x.u)(i,{cacheTime:0}),{roles:[O={}],isLoading:p,refetch:w}=(0,K.u)({id:i},{cacheTime:0}),{permissions:k,isLoading:z}=(0,x.a)({id:i},{cacheTime:0}),q=async C=>{try{J(),g(!0);const{permissionsToSend:u,didUpdateConditions:y}=e.current.getPermissions();await o(`/admin/roles/${i}`,C),O.code!=="strapi-super-admin"&&(await o(`/admin/roles/${i}/permissions`,{permissions:u}),y&&V("didUpdateConditions")),e.current.setFormAfterSubmit(),await w(),d({type:"success",message:{id:"notification.success.saved"}})}catch(u){d({type:"warning",message:X(u)})}finally{g(!1),Q()}},$=!p&&O.code==="strapi-super-admin";return(0,t.jsxs)(T.o,{children:[(0,t.jsx)(a.SL,{name:"Roles"}),(0,t.jsx)(E.J9,{enableReinitialize:!0,initialValues:{name:O.name,description:O.description},onSubmit:q,validationSchema:N,validateOnChange:!1,children:({handleSubmit:C,values:u,errors:y,handleChange:ss,handleBlur:ts})=>(0,t.jsxs)("form",{onSubmit:C,children:[(0,t.jsx)(U.T,{primaryAction:(0,t.jsx)(r.k,{gap:2,children:(0,t.jsx)(R.z,{disabled:O.code==="strapi-super-admin",onClick:C,loading:A,size:"L",children:n({id:"global.save",defaultMessage:"Save"})})}),title:n({id:"Settings.roles.edit.title",defaultMessage:"Edit a role"}),subtitle:n({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:(0,t.jsx)(a.rU,{startIcon:(0,t.jsx)(Z.Z,{}),to:"/settings/roles",children:n({id:"global.back",defaultMessage:"Back"})})}),(0,t.jsx)(W.D,{children:(0,t.jsxs)(r.k,{direction:"column",alignItems:"stretch",gap:6,children:[(0,t.jsx)(j,{isLoading:p||z,disabled:$,errors:y,values:u,onChange:ss,onBlur:ts,role:O}),!G&&!p&&!z?(0,t.jsx)(_.x,{shadow:"filterShadow",hasRadius:!0,children:(0,t.jsx)(x.P,{isFormDisabled:$,permissions:k,ref:e,layout:b})}):(0,t.jsx)(_.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:(0,t.jsx)(a.dO,{})})]})})]})})]})},Y=()=>{const d=(0,c.v9)(f.s),{isLoading:n,allowedActions:{canRead:i,canUpdate:o}}=(0,a.ss)({read:d.settings.roles.read,update:d.settings.roles.update});return n?(0,t.jsx)(a.dO,{}):!i&&!o?(0,t.jsx)(P.l_,{to:"/"}):(0,t.jsx)(H,{})}},73314:function(S,M,s){s.d(M,{u:function(){return f}});var t=s(27279),a=s(87006),c=s(61020),P=s(40464);const f=(v={},_={})=>{const{id:r="",...m}=v,{get:R}=(0,a.kY)(),{locale:B}=(0,c.Z)(),h=(0,a.Xe)(B,{sensitivity:"base"}),{data:l,error:I,isError:T,isLoading:U,refetch:W}=(0,P.useQuery)(["roles",r,m],async()=>{const{data:E}=await R(`/admin/roles/${r??""}`,{params:m});return E},_);return{roles:t.useMemo(()=>{let E=[];return l&&(Array.isArray(l.data)?E=l.data:E=[l.data]),[...E].sort((L,K)=>h.compare(L.name,K.name))},[l,h]),error:I,isError:T,isLoading:U,refetch:W}}},76827:function(S,M,s){s.d(M,{Z:function(){return c}});var t=s(74081);const a=P=>(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...P,children:(0,t.jsx)("path",{fill:"#212134",d:"M24 13.3a.2.2 0 0 1-.2.2H5.74l8.239 8.239a.2.2 0 0 1 0 .282L12.14 23.86a.2.2 0 0 1-.282 0L.14 12.14a.2.2 0 0 1 0-.282L11.86.14a.2.2 0 0 1 .282 0L13.98 1.98a.2.2 0 0 1 0 .282L5.74 10.5H23.8c.11 0 .2.09.2.2v2.6Z"})}),c=a}}]);
